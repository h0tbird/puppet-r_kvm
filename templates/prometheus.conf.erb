#------------------------------------------------------------------------------
# Global default settings:
#------------------------------------------------------------------------------

global: {

  scrape_interval: "15s"     # By default, scrape targets every 15 seconds.
  evaluation_interval: "15s" # By default, evaluate rules every 15 seconds.

  # Attach these extra labels to all time series collected by this
  # Prometheus instance.

  labels: {
    label: {
      name: "cell"
      value: "0"
    }
    label: {
      name: "datacenter"
      value: "ofi"
    }
  }

  # Load and evaluate rules in this file every 'evaluation_interval' seconds.
  # This field may be repeated.

  rule_file: "/etc/prometheus/prometheus.rules"
}

#------------------------------------------------------------------------------
# A job definition containing exactly one endpoint to scrape:
# Prometheus itself.
#-----------------------------------------------------------------------------

job: {

  # The job name is added as a label `job={job-name}` to any time series
  # scraped from this job.

  name: "prometheus"

  # Override the global default and scrape targets from this job every 5
  # seconds.

  scrape_interval: "5s"

  # Let's define a group of static targets to scrape for this job. In this
  # case, only one.

  target_group: {

    # These endpoints are scraped via HTTP.

    target: "http://core-1<% if @domain -%>.<%= @domain %><% end -%>:9191/metrics"
    target: "http://core-2<% if @domain -%>.<%= @domain %><% end -%>:9191/metrics"
    target: "http://core-3<% if @domain -%>.<%= @domain %><% end -%>:9191/metrics"
  }
}

#------------------------------------------------------------------------------
# Scrape cAdvisor:
#------------------------------------------------------------------------------

job: {

  name: "cAdvisor"
  scrape_interval: "5s"

  target_group: {

    target: "http://core-1<% if @domain -%>.<%= @domain %><% end -%>:4194/metrics"
    target: "http://core-2<% if @domain -%>.<%= @domain %><% end -%>:4194/metrics"
    target: "http://core-3<% if @domain -%>.<%= @domain %><% end -%>:4194/metrics"

    labels: {
      label: {
        name: "group"
        value: "masters"
      }
    }
  }

  target_group: {

    target: "http://core-4<% if @domain -%>.<%= @domain %><% end -%>:4194/metrics"
    target: "http://core-5<% if @domain -%>.<%= @domain %><% end -%>:4194/metrics"
    target: "http://core-6<% if @domain -%>.<%= @domain %><% end -%>:4194/metrics"
    target: "http://core-7<% if @domain -%>.<%= @domain %><% end -%>:4194/metrics"
    target: "http://core-8<% if @domain -%>.<%= @domain %><% end -%>:4194/metrics"

    labels: {
      label: {
        name: "group"
        value: "slaves"
      }
    }
  }
}
