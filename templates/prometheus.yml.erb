#------------------------------------------------------------------------------
# Global default settings:
#------------------------------------------------------------------------------

global:
  scrape_interval: 1m
  scrape_timeout: 10s
  evaluation_interval: 10s
  labels:
    cell: 0
    datacenter: ofi

#------------------------------------------------------------------------------
# Rule files:
#------------------------------------------------------------------------------

rule_files:
 - /etc/prometheus/prometheus.rules

#------------------------------------------------------------------------------
# Scrape Prometheus:
#-----------------------------------------------------------------------------

scrape_configs:

- job_name: prometheus
  scrape_interval: 10s
  scheme: http
  target_groups:
  - targets:
<% @masters.each do |master| -%>
    - <%= master %><% if @domain -%>.<%= @domain %><% end -%>:9191
<% end -%>

#------------------------------------------------------------------------------
# Scrape cAdvisor:
#------------------------------------------------------------------------------

- job_name: cAdvisor
  scrape_interval: 10s
  scheme: http
  target_groups:
  - targets:
<% @masters.each do |master| -%>
    - <%= master %><% if @domain -%>.<%= @domain %><% end -%>:4194
<% end -%>
    labels:
      group: masters
  - targets:
<% 12.times do |id| -%>
  <% !@masters.include?("core-#{id}") %>
    - core-<%= id %><% if @domain -%>.<%= @domain %><% end -%>:4194
  <% end -%>
<% end -%>
    labels:
      group: slaves
